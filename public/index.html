<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="Sistema de busca dinâmica de CEPs e endereços" />
    <title>Busca Dinâmica - CEPs e Endereços</title>

    <!-- React CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- Babel para JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
          'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
          sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
    </style>
  </head>
  <body>
    <noscript>Você precisa habilitar o JavaScript para executar esta aplicação.</noscript>
    <div id="root"></div>

    <script type="text/babel">
      // Componente StateFilter
      const StateFilter = ({ availableStates, selectedState, onStateChange, loading }) => {
        return (
          <div className="w-full">
            <label htmlFor="state-filter" className="block text-sm font-medium text-gray-700 mb-2">
              Filtrar por Estado
            </label>
            <div className="relative">
              <select
                id="state-filter"
                value={selectedState}
                onChange={(e) => onStateChange(e.target.value)}
                disabled={loading}
                className="w-full px-4 py-3 pr-10 text-gray-900 bg-white border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100 disabled:cursor-not-allowed transition-all duration-200"
              >
                <option value="">Todos os Estados</option>
                {availableStates.map((state) => (
                  <option key={state} value={state}>
                    {state}
                  </option>
                ))}
              </select>

              <div className="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                <svg className="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
                </svg>
              </div>
            </div>

            {selectedState && (
              <div className="mt-2 flex items-center text-sm text-blue-600">
                <svg className="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
                Estado: {selectedState}
              </div>
            )}
          </div>
        );
      };

      // Componente principal simplificado para demonstração
      const App = () => {
        const [selectedState, setSelectedState] = React.useState('');
        const [availableStates, setAvailableStates] = React.useState([]);
        const [loading, setLoading] = React.useState(true);
        const [addresses, setAddresses] = React.useState([]);
        const [searchTerm, setSearchTerm] = React.useState('');

        React.useEffect(() => {
          fetch('/ceps.json')
            .then(response => response.json())
            .then(data => {
              const states = [...new Set(data.map(addr => addr.estado).filter(Boolean))].sort();
              setAvailableStates(states);
              setAddresses(data);
              setLoading(false);
            })
            .catch(error => {
              console.error('Erro ao carregar CEPs:', error);
              setLoading(false);
            });
        }, []);

        const filteredAddresses = React.useMemo(() => {
          if (!searchTerm || searchTerm.length < 2) return [];

          let filtered = addresses;

          if (selectedState) {
            filtered = filtered.filter(addr => addr.estado === selectedState);
          }

          const term = searchTerm.toUpperCase();
          filtered = filtered.filter(addr =>
            (addr.logradouro && addr.logradouro.toUpperCase().includes(term)) ||
            (addr.bairro && addr.bairro.toUpperCase().includes(term)) ||
            (addr.cidade && addr.cidade.toUpperCase().includes(term)) ||
            (addr.cep && addr.cep.includes(term))
          );

          return filtered.slice(0, 50);
        }, [addresses, selectedState, searchTerm]);

        return (
          <div className="min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50">
            <div className="max-w-4xl mx-auto px-4 py-8">
              <h1 className="text-3xl font-bold text-center text-gray-800 mb-8">
                Busca Dinâmica de CEPs
              </h1>

              <div className="bg-white/80 backdrop-blur-xl rounded-3xl shadow-xl border border-white/20 p-6 mb-8">
                <div className="space-y-6">
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <StateFilter
                      availableStates={availableStates}
                      selectedState={selectedState}
                      onStateChange={setSelectedState}
                      loading={loading}
                    />

                    <div className="w-full">
                      <label htmlFor="search" className="block text-sm font-medium text-gray-700 mb-2">
                        Buscar Endereço
                      </label>
                      <input
                        id="search"
                        type="text"
                        value={searchTerm}
                        onChange={(e) => setSearchTerm(e.target.value)}
                        placeholder="Digite CEP, logradouro, bairro ou cidade..."
                        className="w-full px-4 py-3 text-gray-900 bg-white border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      />
                    </div>
                  </div>
                </div>
              </div>

              {searchTerm.length >= 2 && (
                <div className="bg-white/90 backdrop-blur-sm rounded-2xl shadow-lg border border-gray-100 p-6 mb-6">
                  <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">
                    <div className="text-center">
                      <div className="text-2xl font-bold text-blue-600 mb-1">
                        {filteredAddresses.length}
                      </div>
                      <div className="text-sm text-gray-600">
                        {filteredAddresses.length === 1 ? 'Resultado' : 'Resultados'}
                      </div>
                    </div>

                    <div className="text-center">
                      <div className="text-lg font-semibold text-gray-800 mb-1">
                        {selectedState || 'Todos'}
                      </div>
                      <div className="text-sm text-gray-600">
                        {selectedState ? 'Estado filtrado' : 'Todos os estados'}
                      </div>
                    </div>

                    <div className="text-center">
                      <div className="text-lg font-semibold text-gray-800 mb-1 truncate">
                        "{searchTerm}"
                      </div>
                      <div className="text-sm text-gray-600">
                        Termo de busca
                      </div>
                    </div>
                  </div>
                </div>
              )}

              {filteredAddresses.length > 0 && (
                <div className="space-y-4">
                  {filteredAddresses.map((address, index) => (
                    <div key={index} className="bg-white rounded-xl shadow-md border border-gray-200 p-4">
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                          <div className="font-semibold text-gray-800">
                            {address.logradouro || 'Logradouro não informado'}
                          </div>
                          <div className="text-gray-600">
                            {address.bairro}
                          </div>
                        </div>
                        <div>
                          <div className="font-semibold text-blue-600">
                            {address.cep}
                          </div>
                          <div className="text-gray-600">
                            {address.cidade} - {address.estado}
                          </div>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              )}

              {loading && (
                <div className="text-center py-8">
                  <div className="text-gray-600">Carregando dados...</div>
                </div>
              )}
            </div>
          </div>
        );
      };

      // Renderizar a aplicação
      ReactDOM.render(<App />, document.getElementById('root'));
    </script>
  </body>
</html>
